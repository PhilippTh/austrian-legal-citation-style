% TODO:
% - ignore prefix in sorting

\ProvidesFile{biblatex.cfg}[2026/02/14 v003]
% author-maintainer: Philipp Thumfart, philipp@thumfart.eu

%%%%%%%%%%%%%%%%%%%%%%%
%%% General Section %%%
%%%%%%%%%%%%%%%%%%%%%%%

\RequireCitationStyle{verbose}

% Options
\ExecuteBibliographyOptions{
  maxnames=5,        % Truncate author list after 5 authors ...
  minnames=3,        % ... but display at least 3 authors
  alldates=short,    % general date format
  citetracker=true,  %
  hyperref=true,     %
  dashed=false,
  mincrossrefs=1     % Auto-include parent @book in bibliography when any @inbook cites it via crossref
}

% Comma between bibliography units
\renewcommand*{\newunitpunct}{\addcomma\addspace}
% Only articles should have a comma before their postnote
\renewcommand*{\postnotedelim}{\ifentrytype{article}{\addcomma}{}\addspace}

% No prefix for pages
\DeclareFieldFormat{pages}{\mkfirstpage{#1}}
\DeclareFieldFormat{postnote}{\mkfirstpage{#1}}
\DeclareFieldFormat{multipostnote}{\mkfirstpage{#1}}

% Multiple author names are separated by a slash
\DeclareDelimFormat{multinamedelim}{\slash}
\DeclareDelimFormat{finalnamedelim}{\slash}
\DeclareDelimFormat[textcite]{multinamedelim}{\addcomma\space}
\DeclareDelimFormat[textcite]{finalnamedelim}{\addnbspace\bibstring{and}\space}

% Italicize surnames
\renewcommand*{\mkbibnamefamily}{\mkbibemph}
\renewcommand*{\mkbibnameprefix}{\mkbibemph}
\renewcommand*{\mkbibnamesuffix}{\mkbibemph}

% Create our own name format that only shows the family name
\DeclareNameFormat{family}{%
  \usebibmacro{name:family}
    {\namepartfamily}
    {\namepartgiven}
    {\namepartprefix}
    {\namepartsuffix}%
  \usebibmacro{name:andothers}}

% Title should not have quotation marks and should not be italicized
\DeclareFieldFormat*{title}{#1}
\DeclareFieldFormat*{booktitle}{#1}
\DeclareFieldFormat*{citetitle}{#1}
\DeclareFieldFormat*{journaltitle}{#1}

\newbibmacro*{title_with_comma}{%
  % Title should only be followed by a comma if the title does not end with a punctuation mark
  \printfield{title}%
  \ifpunct{}{\addcomma}\addspace%
}

% This macro outputs the starting page by default if a pinpoint citation as postnote is missing
\newbibmacro*{startingpage}{%
  \iffieldundef{postnote}%
    {\iffieldundef{pages}{}%
      {\addcomma\addspace\printfield{pages}}}%
    {}%
}

\newbibmacro*{in_bookauthor_and_editor}{%
  % If neither bookauthor nor editor is defined, this is an error in the bib file
  \printtext{in }%
  \ifnameundef{bookauthor}
    {\ifnameundef{editor}%
      {}%
      {\printnames[family]{editor}}}%
    {\printnames[family]{bookauthor}%
     \ifnameundef{editor}%
       {}%
       {\printdelim{multinamedelim}\printnames[family]{editor}}}%
}

\newbibmacro*{author_and_editor}{%
  % This macro displayes the author and the editor if available
  % This is used for books where there are both authors and editors which we then want to display in one line
  \ifnameundef{author}%
    {\ifnameundef{editor}%
      {}{\printnames[family]{editor}}}%
    {\printnames[family]{author}%
     \ifnameundef{editor}%
       {}%
       {\printdelim{multinamedelim}\printnames[family]{editor}}}}

% Volume should be in Roman numerals and edition in superscript
\DeclareFieldFormat{volume}{\RN{#1}}
\DeclareFieldFormat{edition}{\textsuperscript{#1}}

\newbibmacro*{volume_edition}{%
  % If there is no volume, the edition should be displayed without a space
  \iffieldundef{volume}{}{\addspace\printfield{volume}}%
  \printfield{edition}%
}

% For subsequent citations
\renewbibmacro*{cite:short}{%
  \ifbibmacroundef{cite:short:@\strfield{entrytype}}
    {\usebibmacro{cite:short:standard}}
    {\usebibmacro*{cite:short:@\strfield{entrytype}}}}

\newbibmacro*{cite:short:standard}{%
  \printnames[family]{labelname}%
  \setunit*{\printdelim{nametitledelim}}%
  \printtext[bibhyperlink]{%
    \printfield[citetitle]{labeltitle}}}


%%%%%%%%%%%%%%%
%%% article %%%
%%%%%%%%%%%%%%%

% The following is used for articles in journals

\newbibmacro*{journal_issue}{%
  % If the "issue" field is defined, we use it, otherwise, we check the "number" field and use it if present, followed by a slash and the year
  \addspace%
  \iffieldundef{issue}
    {\iffieldundef{number}
      {}
      {\printfield{number}\slash}}
    {\printfield{issue}\slash}%
  \printfield{year}}

% If there is a pinpoint citation as postnote, first output the starting page and then the pinpoint citation in parentheses
\DeclareFieldFormat[article]{postnote}{\addspace\printfield{pages}\addspace\mkbibparens{#1}}

% The footnote citation style for articles is defined below
\DeclareBibliographyDriver{article}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \printnames[family]{author}%
  \newunit%
  % The title
  \usebibmacro{title_with_comma}%
  % Journal name and issue
  \usebibmacro{journal}%
  \usebibmacro{journal_issue}%
  % and then the starting page or pinpoint citation
  \usebibmacro{startingpage}%
  \usebibmacro{finentry}}

\newbibmacro*{cite:short:@article}{%
  \printnames[family]{author}%
  \newunit%
  % Journal name and issue
  \usebibmacro{journal}%
  \usebibmacro{journal_issue}%
  % and then the starting page or pinpoint citation
  \usebibmacro{startingpage}}


%%%%%%%%%%%%
%%% book %%%
%%%%%%%%%%%%

% The footnote citation style for books is defined below:
\DeclareBibliographyDriver{book}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{author_and_editor}%
  \newunit%
  \printfield{title}%
  \usebibmacro{volume_edition}%
  \addspace\mkbibparens{\printfield{year}}%
  \usebibmacro{finentry}}

% Also apply this style for mvbook
\DeclareBibliographyAlias{mvbook}{book}

\newbibmacro*{cite:short:@book+mvbook}{%
  \usebibmacro{author_and_editor}%
  \newunit%
  \iffieldundef{shorttitle}%
    {\printfield{title}}%
    {\printfield{shorttitle}}%
  \usebibmacro{volume_edition}}

\newbibmacro*{cite:short:@book}{%
  \usebibmacro{cite:short:@book+mvbook}} 

\newbibmacro*{cite:short:@mvbook}{%
  \usebibmacro{cite:short:@book+mvbook}}

%%%%%%%%%%%%%%
%%% inbook %%%
%%%%%%%%%%%%%%

% The following is used for commentary entries (AZR Rule 78)
% Format: Author in Editor, BookTitle Volume^Edition (Year) Title [Postnote]
%
% The title field holds the paragraph reference (e.g. "\S~254") that identifies
% the contribution.  It is always shown.  The postnote carries the Rz (marginal
% number) which varies per citation and is appended without parentheses.

% Exclude @inbook from the bibliography automatically: commentary entries are
% cited in footnotes but only the parent @book appears in the Literaturverzeichnis.
% The sourcemap injects skipbib into the options field for all @inbook entries,
% so \printbibliography will skip them without any user-side options.
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
      \pertype{inbook}
      \step[fieldset=options, fieldvalue={skipbib}, append]
    }
  }
}

% Postnote for @inbook: no parentheses (AZR does not parenthesise Rz in commentaries)
\DeclareFieldFormat[inbook]{postnote}{#1}

% First citation: Author in Editor, BookTitle Volume^Edition (Year) Title
\DeclareBibliographyDriver{inbook}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \printnames[family]{author}%
  \addspace%
  \usebibmacro{in_bookauthor_and_editor}%
  \newunit%
  \printfield{booktitle}%
  \usebibmacro{volume_edition}%
  \addspace\mkbibparens{\printfield{year}}%
  \iffieldundef{title}{}{\addspace\printfield{title}}%
  \usebibmacro{finentry}}

% Subsequent citation: Author in Editor, BookTitle Volume^Edition Title
\newbibmacro*{cite:short:@inbook}{%
  \printnames[family]{author}%
  \addspace%
  \usebibmacro{in_bookauthor_and_editor}%
  \newunit%
  \printfield{booktitle}%
  \usebibmacro{volume_edition}%
  \iffieldundef{title}{}{\addspace\printfield{title}}}%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% incollection/inproceedings %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% The following is used for articles in conference proceedings and collections

% If there is a pinpoint citation as postnote, first output the starting page and then the pinpoint citation in parentheses
\DeclareFieldFormat[incollection]{postnote}{\printfield{pages} \mkbibparens{#1}}
\DeclareFieldFormat[inproceedings]{postnote}{\printfield{pages} \mkbibparens{#1}}

% The footnote citation style for collection/festschrift contributions is defined below:
% AZR Rule 71 (Sammelband): Author, Title, in Editor (Hrsg), BookTitle (Year) Page
% AZR Rule 70 (Festschrift): Author, Title, in FS Name (Year) Page -- no editor/(Hrsg)
\DeclareBibliographyDriver{incollection}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \printnames[family]{author}%
  \newunit%
  \usebibmacro{title_with_comma}%
  % Editor with (Hrsg) -- only if editor is defined (Rule 71 vs 70)
  \usebibmacro{in_bookauthor_and_editor}%
  \ifnameundef{editor}{}{\addspace\printtext{(Hrsg)}}%
  \newunit%
  % then the book title
  \printfield{booktitle}%
  \usebibmacro{volume_edition}%
  \addspace\mkbibparens{\printfield{year}}%
  % and then the starting page or pinpoint citation
  \usebibmacro{startingpage}%
  \usebibmacro{finentry}}

\DeclareBibliographyAlias{inproceedings}{incollection}

\newbibmacro*{cite:short:@incollection+inproceedings}{%
  \printnames[family]{author}%
  \addspace%
  % Editor with (Hrsg) -- only if editor is defined
  \usebibmacro{in_bookauthor_and_editor}%
  \ifnameundef{editor}{}{\addspace\printtext{(Hrsg)}}%
  \newunit%
  % then the book title
  \printfield{booktitle}%
  \usebibmacro{volume_edition}%
  % and then the starting page or pinpoint citation
  \usebibmacro{startingpage}}%

\newbibmacro*{cite:short:@incollection}{%
  \usebibmacro{cite:short:@incollection+inproceedings}}%

\newbibmacro*{cite:short:@inproceedings}{%
  \usebibmacro{cite:short:@incollection+inproceedings}}%


%%%%%%%%%%%%%%%%%%%%%
%%% thesis/report %%%
%%%%%%%%%%%%%%%%%%%%%

% The footnote citation style for theses is defined below:
\DeclareBibliographyDriver{thesis}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{author_and_editor}%
  \newunit%
  \printfield{title}%
  \addspace\mkbibparens{\printfield{year}}%
  \usebibmacro{finentry}}%

\DeclareBibliographyAlias{report}{thesis}

\newbibmacro*{cite:short:@thesis:common}{%
  \usebibmacro{author_and_editor}%
  \newunit%
  \iffieldundef{shorttitle}%
    {\printfield{title}}%
    {\printfield{shorttitle}}}%

\newbibmacro*{cite:short:@thesis}{%
  \usebibmacro{cite:short:@thesis:common}}%

\newbibmacro*{cite:short:@report}{%
  \usebibmacro{cite:short:@thesis:common}}%


%%%%%%%%%%%%%%%%%%%%
%%% jurisdiction %%%
%%%%%%%%%%%%%%%%%%%%

\DeclareBibliographyDriver{jurisdiction}{%
\usebibmacro{bibindex}%
\usebibmacro{begentry}%
\printlist{institution}%
\setunit{\addspace}\newblock%
\usebibmacro{date}%
\setunit{\addcomma\addspace}\newblock%
\printfield{number}%
\setunit{\addspace}\newblock
\mkbibemph{\usebibmacro{title}}%
\usebibmacro{finentry}}

%%%%%%%%%%%%%%%%%%%
%%% legislation %%%
%%%%%%%%%%%%%%%%%%%

\DeclareBibliographyDriver{legislation}{%
\usebibmacro{bibindex}%
\usebibmacro{begentry}%
\usebibmacro{title}%
\usebibmacro{finentry}}

%%%%%%%%%%%%%%
%%% online %%%
%%%%%%%%%%%%%%

%\DeclareFieldFormat[online]{url}{#1}

\endinput

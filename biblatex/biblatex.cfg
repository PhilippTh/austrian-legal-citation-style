% TODO:
% - don't show redactor
% - decalre bib driver also for mvbook
% - format subsequent citations

\ProvidesFile{biblatex.cfg}
\ExecuteBibliographyOptions{% This can also be included into some internal file, e.g. _settings.tex
  maxnames=5,        % Truncate author list after 5 authors ...
  minnames=3,        % ... but display at least 5 authors
  alldates=short,    % general date format
  citepages=suppress %
}

% -- comma between bibliography units
\renewcommand*{\newunitpunct}{\addcomma\space}

% -- No prefix for pages
\DeclareFieldFormat{pages}{#1}
\DeclareFieldFormat{postnote}{#1}
\DeclareFieldFormat{multipostnote}{#1}

% -- No italic titles
\DeclareFieldFormat{title}{#1}
\DeclareFieldFormat{booktitle}{#1}
\DeclareFieldFormat{citetitle}{#1}
\DeclareFieldFormat{journaltitle}{#1}

% -- No "'" for title
\DeclareFieldFormat[article,inbook,incollection,inproceedings,patent,thesis,unpublished]{citetitle}{#1}
\DeclareFieldFormat[article,inbook,incollection,inproceedings,patent,thesis,unpublished]{title}{#1}

% -- Authors and editors in italic and only show surname
\DeclareNameFormat{family}{\mkbibemph{%
  \usebibmacro{name:family}
    {\namepartfamily}
    {\namepartgiven}
    {\namepartprefix}
    {\namepartsuffix}}%
  \usebibmacro{name:andothers}}
\DeclareNameAlias{default}{family}
\DeclareNameAlias{sortname}{default}
\DeclareNameAlias{labelname}{default}

% -- "/" between names but "," and "and" in textcite
\DeclareDelimFormat{multinamedelim}{\slash}
\DeclareDelimAlias{finalnamedelim}{multinamedelim}
\DeclareDelimFormat[textcite]{multinamedelim}{\addcomma\space}
\DeclareDelimFormat[textcite]{finalnamedelim}{\addnbspace\bibstring{and}\space}

% -- Volume in roman integers
\DeclareFieldFormat{volume}{\RN{#1}}
\DeclareFieldFormat{edition}{\textsuperscript{#1}}

% -- Put date in parentheses
\DeclareFieldFormat[book,mvbook,collection]{date}{\parentext{#1}}

\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \step[fieldset=publisher, null]
       \step[fieldset=language, null]
       \step[fieldset=location, null]
       \step[fieldset=isbn, null]
       \step[fieldset=issn, null]
       \step[fieldset=doi, null]
       \step[fieldset=note, null]
       \step[fieldset=volumes, null]
    }
  }
}

%%%%%%%%%%%%%%%%%%%%%%%
% -- BOOK
%%%%%%%%%%%%%%%%%%%%%%%
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \pertype{book}
       \pertype{mvbook}
       \step[fieldset=series, null]
       \step[fieldset=number, null]
       \step[fieldset=day, null]
       \step[fieldset=month, null]
       \step[fieldset=pagetotal, null]
       \step[fieldset=pages, null]
       \step[fieldset=url, null]
       \step[fieldset=urldate, null]
       \step[fieldset=review, null]
       \step[fieldset=series, null]
    }
  }
}

% -- Renew Bibliography Driver
\DeclareBibliographyDriver{book}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{author/editor}%
  \setunit{\printdelim{nametitledelim}}\newblock
  \usebibmacro{maintitle+title}%
  \setunit{\space}%
  \iffieldundef{maintitle}
    {\printfield{volume}%
     \printfield{part}}
    {}%
  \setunit{}%
  \printfield[superedition]{edition}%
  \setunit{\addspace}\newblock
  \usebibmacro{date}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \newunit\newblock
  \iftoggle{bbx:related}
    {\usebibmacro{related:init}%
     \usebibmacro{related}}
    {}%
  \usebibmacro{finentry}}

%%%%%%%%%%%%%%%%%%%%%%%
% -- COLLECTION
%%%%%%%%%%%%%%%%%%%%%%%
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \pertype{collection}
       \step[fieldset=day, null]
       \step[fieldset=month, null]
       \step[fieldset=pagetotal, null]
       \step[fieldset=url, null]
       \step[fieldset=urldate, null]
       \step[fieldset=review, null]
       \step[fieldset=series, null]
    }
  }
}

% -- Renew Bibliography Driver
\DeclareBibliographyDriver{collection}{%
  \usebibmacro{bibindex}%
  \usebibmacro{begentry}%
  \usebibmacro{editor}%
  \setunit{\printdelim{nametitledelim}}\newblock
  \usebibmacro{maintitle+title}%
  \setunit{\space}%
  \iffieldundef{maintitle}
    {\printfield{volume}%
     \printfield{part}}
    {}%
  \setunit{}%
  \printfield[superedition]{edition}%
  \setunit{\addspace}\newblock
  \usebibmacro{date}%
  \setunit{\bibpagerefpunct}\newblock
  \usebibmacro{pageref}%
  \newunit\newblock
  \iftoggle{bbx:related}
    {\usebibmacro{related:init}%
     \usebibmacro{related}}
    {}%
  \usebibmacro{finentry}}

%%%%%%%%%%%%%%%%%%%%%%%
% -- INCOLLECTION
%%%%%%%%%%%%%%%%%%%%%%%
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \pertype{incollection}
       \step[fieldset=day, null]
       \step[fieldset=month, null]
       \step[fieldset=url, null]
       \step[fieldset=urldate, null]
       \step[fieldset=review, null]
       \step[fieldset=series, null]
    }
  }
}

%%%%%%%%%%%%%%%%%%%%%%%
% -- ARTICLE
%%%%%%%%%%%%%%%%%%%%%%%
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \pertype{article}
       \step[fieldset=day, null]
       \step[fieldset=month, null]
       \step[fieldset=url, null]
       \step[fieldset=urldate, null]
       \step[fieldset=review, null]
       \step[fieldset=series, null]
    }
  }
}

%%%%%%%%%%%%%%%%%%%%%%%
% -- INPROCEEDING
%%%%%%%%%%%%%%%%%%%%%%%
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \pertype{inproceedings}
       \step[fieldset=day, null]
       \step[fieldset=month, null]
       \step[fieldset=url, null]
       \step[fieldset=urldate, null]
       \step[fieldset=review, null]
       \step[fieldset=series, null]
    }
  }
}

%%%%%%%%%%%%%%%%%%%%%%%
% -- THESIS
%%%%%%%%%%%%%%%%%%%%%%%
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \pertype{thesis}
       \step[fieldset=day, null]
       \step[fieldset=month, null]
       \step[fieldset=pagetotal, null]
       \step[fieldset=url, null]
       \step[fieldset=urldate, null]
       \step[fieldset=review, null]
       \step[fieldset=series, null]
    }
  }
}

%%%%%%%%%%%%%%%%%%%%%%%
% -- JURISDICTION
%%%%%%%%%%%%%%%%%%%%%%%
\DeclareBibliographyDriver{jurisdiction}{%
\usebibmacro{bibindex}%
\usebibmacro{begentry}%
\printlist{institution}\space%
\usebibmacro{date}\addcomma\space%
\printfield{number}\space%
\usebibmacro{title}%
\usebibmacro{finentry}}

%%%%%%%%%%%%%%%%%%%%%%%
% -- ONLINE
%%%%%%%%%%%%%%%%%%%%%%%
\DeclareFieldFormat[online]{url}{#1}

%%%%%%%%%%%%%%%%%%%%%%%
% -- REPORT
%%%%%%%%%%%%%%%%%%%%%%%
\DeclareSourcemap{
  \maps[datatype=bibtex]{
    \map{
       \pertype{report}
       \step[fieldset=url, null]
       \step[fieldset=urldate, null]
    }
  }
}
\endinput
